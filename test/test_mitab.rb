require 'minitest/autorun'
require 'mitab'
class MitabParserTest < Minitest::Test
    def setup
      @dir = "#{Dir.pwd}/test"
      @text = open("#{@dir}/file.txt") { |f| f.read }
      @m = Mitab::MitabParser.new(@text)
    end

    def test_parser
      output = {:links=>[{:source=>"Q82235", :target=>"Q9DBG9", :detMethods=>[{:name=>"MI:0096", :value=>"pull down"}], :firstAuthor=>["Kanamori et al. (2003)"], :publications=>[{:name=>"pubmed", :score=>"12874278"}], :intTypes=>[{:name=>"MI:0407", :value=>"direct interaction"}], :sourceDbs=>[{:name=>"MI:0469", :value=>"IntAct"}], :intIds=>[{:name=>"intact", :value=>"EBI-1162495"}], :scores=>[{:name=>"intact-miscore", :score=>"0.44"}]}, {:source=>"P04578", :target=>"B0FAM1", :detMethods=>[{:name=>"MI:0007", :value=>"anti tag coimmunoprecipitation"}], :firstAuthor=>["Jager et al. (2012)"], :publications=>[{:name=>"pubmed", :score=>"22190034"}, {:name=>"psi-mi", :score=>"\"MI"}, {:name=>"imex", :score=>"IM-17346"}], :intTypes=>[{:name=>"MI:0914", :value=>"association"}], :sourceDbs=>[{:name=>"MI:0469", :value=>"IntAct"}], :intIds=>[{:name=>"intact", :value=>"EBI-6174316"}, {:name=>"imex", :value=>"IM-17346-4"}], :scores=>[{:name=>"intact-miscore", :score=>"0.35"}]}], :nodes=>[{:id=>"Q82235", :ids=>[{:name=>"uniprotkb", :value=>"Q82235"}, {:name=>"intact", :value=>"EBI-1162486"}, {:name=>"psi-mi", :value=>"q82235_9dela(display_long)"}, {:name=>"uniprotkb", :value=>"tax(gene name)"}, {:name=>"psi-mi", :value=>"tax(display_short)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"Q82235"}, {:name=>"uniprotkb", :value=>"tax(gene name)"}], :geneName=>["tax"], :altIds=>[{:name=>"intact", :value=>"EBI-1162486"}], :taxonomy=>["taxid:11908(humt-)"]}, {:id=>"Q9DBG9", :ids=>[{:name=>"uniprotkb", :value=>"Q9DBG9"}, {:name=>"intact", :value=>"EBI-1161647"}, {:name=>"psi-mi", :value=>"tx1b3_mouse(display_long)"}, {:name=>"uniprotkb", :value=>"Tax interaction protein 1(gene name synonym)"}, {:name=>"uniprotkb", :value=>"Tax1bp3(gene name)"}, {:name=>"psi-mi", :value=>"Tax1bp3(display_short)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"Q9DBG9"}, {:name=>"uniprotkb", :value=>"Tax interaction protein 1(gene name synonym)"}, {:name=>"uniprotkb", :value=>"Tax1bp3(gene name)"}], :geneName=>["Tax1bp3"], :altIds=>[{:name=>"intact", :value=>"EBI-1161647"}], :taxonomy=>["taxid:10090(mouse)"]}, {:id=>"P04578", :ids=>[{:name=>"uniprotkb", :value=>"P04578"}, {:name=>"intact", :value=>"EBI-6163496"}, {:name=>"uniprotkb", :value=>"O09779"}, {:name=>"psi-mi", :value=>"env_hv1h2(display_long)"}, {:name=>"uniprotkb", :value=>"env(gene name)"}, {:name=>"psi-mi", :value=>"env(display_short)"}, {:name=>"uniprotkb", :value=>"Env polyprotein(gene name synonym)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"P04578"}, {:name=>"uniprotkb", :value=>"O09779"}, {:name=>"uniprotkb", :value=>"env(gene name)"}, {:name=>"uniprotkb", :value=>"Env polyprotein(gene name synonym)"}], :geneName=>["env"], :altIds=>[{:name=>"intact", :value=>"EBI-6163496"}, {:name=>"uniprotkb", :value=>"O09779"}], :taxonomy=>["taxid:11706(hv1h2)"]}, {:id=>"B0FAM1", :ids=>[{:name=>"uniprotkb", :value=>"B0FAM1"}, {:name=>"intact", :value=>"EBI-6163546"}, {:name=>"psi-mi", :value=>"b0fam1_9hiv1(display_long)"}, {:name=>"uniprotkb", :value=>"env(gene name)"}, {:name=>"psi-mi", :value=>"env(display_short)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"B0FAM1"}, {:name=>"uniprotkb", :value=>"env(gene name)"}], :geneName=>["env"], :altIds=>[{:name=>"intact", :value=>"EBI-6163546"}], :taxonomy=>["taxid:11676(9hiv1)"]}], :ids=>["Q82235", "Q9DBG9", "P04578", "B0FAM1"], :taxa=>["taxid:11908(humt-)", "taxid:10090(mouse)", "taxid:11706(hv1h2)", "taxid:11676(9hiv1)"], :scores=>[{:name=>"intact-miscore", :min=>0.35, :max=>"0.44"}]}
      assert_equal output, @m.mitab
    end

    def test_scores
      output = {"intact-miscore"=>{:name=>"intact-miscore", :min=>0.35, :max=>"0.44"}}
      assert_equal output, @m.scores
    end

    def test_nodes
      output = {"Q82235"=>{:id=>"Q82235", :ids=>[{:name=>"uniprotkb", :value=>"Q82235"}, {:name=>"intact", :value=>"EBI-1162486"}, {:name=>"psi-mi", :value=>"q82235_9dela(display_long)"}, {:name=>"uniprotkb", :value=>"tax(gene name)"}, {:name=>"psi-mi", :value=>"tax(display_short)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"Q82235"}, {:name=>"uniprotkb", :value=>"tax(gene name)"}], :geneName=>["tax"], :altIds=>[{:name=>"intact", :value=>"EBI-1162486"}], :taxonomy=>["taxid:11908(humt-)"]}, "Q9DBG9"=>{:id=>"Q9DBG9", :ids=>[{:name=>"uniprotkb", :value=>"Q9DBG9"}, {:name=>"intact", :value=>"EBI-1161647"}, {:name=>"psi-mi", :value=>"tx1b3_mouse(display_long)"}, {:name=>"uniprotkb", :value=>"Tax interaction protein 1(gene name synonym)"}, {:name=>"uniprotkb", :value=>"Tax1bp3(gene name)"}, {:name=>"psi-mi", :value=>"Tax1bp3(display_short)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"Q9DBG9"}, {:name=>"uniprotkb", :value=>"Tax interaction protein 1(gene name synonym)"}, {:name=>"uniprotkb", :value=>"Tax1bp3(gene name)"}], :geneName=>["Tax1bp3"], :altIds=>[{:name=>"intact", :value=>"EBI-1161647"}], :taxonomy=>["taxid:10090(mouse)"]}, "P04578"=>{:id=>"P04578", :ids=>[{:name=>"uniprotkb", :value=>"P04578"}, {:name=>"intact", :value=>"EBI-6163496"}, {:name=>"uniprotkb", :value=>"O09779"}, {:name=>"psi-mi", :value=>"env_hv1h2(display_long)"}, {:name=>"uniprotkb", :value=>"env(gene name)"}, {:name=>"psi-mi", :value=>"env(display_short)"}, {:name=>"uniprotkb", :value=>"Env polyprotein(gene name synonym)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"P04578"}, {:name=>"uniprotkb", :value=>"O09779"}, {:name=>"uniprotkb", :value=>"env(gene name)"}, {:name=>"uniprotkb", :value=>"Env polyprotein(gene name synonym)"}], :geneName=>["env"], :altIds=>[{:name=>"intact", :value=>"EBI-6163496"}, {:name=>"uniprotkb", :value=>"O09779"}], :taxonomy=>["taxid:11706(hv1h2)"]}, "B0FAM1"=>{:id=>"B0FAM1", :ids=>[{:name=>"uniprotkb", :value=>"B0FAM1"}, {:name=>"intact", :value=>"EBI-6163546"}, {:name=>"psi-mi", :value=>"b0fam1_9hiv1(display_long)"}, {:name=>"uniprotkb", :value=>"env(gene name)"}, {:name=>"psi-mi", :value=>"env(display_short)"}], :uniprot=>[{:name=>"uniprotkb", :value=>"B0FAM1"}, {:name=>"uniprotkb", :value=>"env(gene name)"}], :geneName=>["env"], :altIds=>[{:name=>"intact", :value=>"EBI-6163546"}], :taxonomy=>["taxid:11676(9hiv1)"]}}
      assert_equal output, @m.nodes
    end

end

